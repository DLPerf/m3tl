---

title: Params


keywords: fastai
sidebar: home_sidebar



nb_path: "source_nbs/00_1_params.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: source_nbs/00_1_params.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Params" class="doc_header"><code>class</code> <code>Params</code><a href="https://github.com/JayYip/m3tl/tree/master/m3tl/params.py#L18" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Params</code>() :: <a href="/m3tl/0_base_params.html#BaseParams"><code>BaseParams</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Add-Problems">Add Problems<a class="anchor-link" href="#Add-Problems"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseParams.register_problem" class="doc_header"><code>BaseParams.register_problem</code><a href="https://github.com/JayYip/m3tl/tree/master/m3tl/base_params.py#L529" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseParams.register_problem</code>(<strong><code>problem_name</code></strong>:<code>str</code>, <strong><code>problem_type</code></strong>=<em><code>'cls'</code></em>, <strong><code>processing_fn</code></strong>:<code>Callable</code>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Add problems.</p>
<p>Args:</p>
<ul>
<li>problem_name (str): problem name.</li>
<li>problem_type (str, optional): One of the following problem types:
['cls', 'seq_tag', 'seq2seq_tag', 'seq2seq_text', 'multi_cls', 'pretrain'].
Defaults to 'cls'.</li>
<li>processing_fn (Callable, optional): preprocessing function. Defaults to None.</li>
</ul>
<p>Raises:</p>
<ul>
<li>ValueError: unexpected problem_type</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">params</span><span class="o">.</span><span class="n">register_problem</span><span class="p">(</span><span class="n">problem_name</span><span class="o">=</span><span class="s1">&#39;toy_cls&#39;</span><span class="p">,</span> <span class="n">problem_type</span><span class="o">=</span><span class="s1">&#39;cls&#39;</span><span class="p">,</span> <span class="n">processing_fn</span><span class="o">=</span><span class="n">toy_cls</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">register_problem</span><span class="p">(</span><span class="n">problem_name</span><span class="o">=</span><span class="s1">&#39;toy_seq_tag&#39;</span><span class="p">,</span> <span class="n">problem_type</span><span class="o">=</span><span class="s1">&#39;seq_tag&#39;</span><span class="p">,</span> <span class="n">processing_fn</span><span class="o">=</span><span class="n">toy_seq_tag</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseParams.register_multiple_problems" class="doc_header"><code>BaseParams.register_multiple_problems</code><a href="https://github.com/JayYip/m3tl/tree/master/m3tl/base_params.py#L539" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseParams.register_multiple_problems</code>(<strong><code>problem_type_dict</code></strong>:<code>Dict</code>[<code>str</code>, <code>str</code>], <strong><code>processing_fn_dict</code></strong>:<code>Dict</code>[<code>str</code>, <code>Callable</code>]=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Add multiple problems.</p>
<p>processing_fn_dict is optional, if it's not provided, processing fn will be set as None.</p>
<p>Args:</p>
<ul>
<li>problem_type_dict (Dict[str, str]): problem type dict</li>
<li>processing_fn_dict (Dict[str, Callable], optional): problem type fn. Defaults to None.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">problem_type_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;toy_cls&#39;</span><span class="p">:</span> <span class="s1">&#39;cls&#39;</span><span class="p">,</span> <span class="s1">&#39;toy_seq_tag&#39;</span><span class="p">:</span> <span class="s1">&#39;seq_tag&#39;</span><span class="p">}</span>
<span class="n">processing_fn_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;toy_cls&#39;</span><span class="p">:</span> <span class="n">toy_cls</span><span class="p">,</span> <span class="s1">&#39;toy_seq_tag&#39;</span><span class="p">:</span> <span class="n">toy_seq_tag</span><span class="p">}</span>
<span class="n">params</span><span class="o">.</span><span class="n">register_multiple_problems</span><span class="p">(</span><span class="n">problem_type_dict</span><span class="o">=</span><span class="n">problem_type_dict</span><span class="p">,</span> <span class="n">processing_fn_dict</span><span class="o">=</span><span class="n">processing_fn_dict</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Adding new problem toy_cls, problem type: cls
Adding new problem toy_seq_tag, problem type: seq_tag
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Assign-Problems">Assign Problems<a class="anchor-link" href="#Assign-Problems"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseParams.assign_problem" class="doc_header"><code>BaseParams.assign_problem</code><a href="https://github.com/JayYip/m3tl/tree/master/m3tl/base_params.py#L636" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseParams.assign_problem</code>(<strong><code>flag_string</code></strong>:<code>str</code>, <strong><code>model_dir</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>base_dir</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>dir_name</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>predicting</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Assign the actual run problem to param. This function will
do the following things:</p>
<ol>
<li>parse the flag string to form the run_problem_list</li>
<li>create checkpoint saving path</li>
<li>calculate total number of training data and training steps</li>
<li>scale learning rate with the number of gpu linearly</li>
</ol>
<p>Arguments:</p>
<ul>
<li>flag_string {str} -- run problem string</li>
<li>example: cws|POS|weibo_ner&amp;weibo_cws</li>
</ul>
<p>Keyword Arguments:</p>
<ul>
<li>gpu {int} -- number of gpu use for training, this will affect the training steps and learning rate (default: {2})</li>
<li>base_dir {str} -- base dir for ckpt, if None, then "models" is assigned (default: {None})</li>
<li>dir_name {str} -- dir name for ckpt, if None, will be created automatically (default: {None})</li>
<li>predicting {bool} -- whether is predicting</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">params</span><span class="o">.</span><span class="n">assign_problem</span><span class="p">(</span><span class="n">flag_string</span><span class="o">=</span><span class="s1">&#39;toy_seq_tag|toy_cls&#39;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">tmp_model_dir</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">params</span><span class="o">.</span><span class="n">problem_assigned</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>WARNING:root:bert_config not exists. will load model from huggingface checkpoint.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>After problem assigned, the model path should be created with tokenizers, label encoder files in it.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Register-new-problem-type">Register new problem type<a class="anchor-link" href="#Register-new-problem-type"> </a></h2><p>You can also implement your own problem type. Essentially, a problem type has:</p>
<ul>
<li>name</li>
<li>top layer</li>
<li>label handling function</li>
<li>label encoder creating function</li>
</ul>
<p>Here we register a vector fitting(vector annealing) problem type as an example.</p>
<p>Note: This is originally designed as an internal API for development. So it's not user-friendly.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseParams.register_problem_type" class="doc_header"><code>BaseParams.register_problem_type</code><a href="https://github.com/JayYip/m3tl/tree/master/m3tl/base_params.py#L487" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseParams.register_problem_type</code>(<strong><code>problem_type</code></strong>:<code>str</code>, <strong><code>top_layer</code></strong>:<code>Model</code>=<em><code>None</code></em>, <strong><code>label_handling_fn</code></strong>:<code>Callable</code>=<em><code>None</code></em>, <strong><code>get_or_make_label_encoder_fn</code></strong>:<code>Callable</code>=<em><code>None</code></em>, <strong><code>inherit_from</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>description</code></strong>:<code>str</code>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>API to register a new problem type</p>
<p>Args:</p>
<ul>
<li>problem_type: string, problem type name</li>
<li>top_layer: a keras model with some specific reqirements</li>
<li>label_handling_fn: function to convert labels to label ids</li>
<li>get_or_make_label_encoder_fn: function to create label encoder, num_classes has to be specified here</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">m3tl.problem_types.utils</span> <span class="kn">import</span> <span class="n">BaseTop</span>
<span class="kn">from</span> <span class="nn">m3tl.problem_types.utils</span> <span class="kn">import</span> <span class="n">empty_tensor_handling_loss</span><span class="p">,</span> <span class="n">nan_loss_handling</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># top layer</span>
<span class="k">class</span> <span class="nc">VectorFit</span><span class="p">(</span><span class="n">BaseTop</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Params</span><span class="p">,</span> <span class="n">problem_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VectorFit</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">problem_name</span><span class="o">=</span><span class="n">problem_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">num_classes</span><span class="p">[</span><span class="n">problem_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dense</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_classes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">feature</span><span class="p">,</span> <span class="n">hidden_feature</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="n">pooled_hidden</span> <span class="o">=</span> <span class="n">hidden_feature</span><span class="p">[</span><span class="s1">&#39;pooled&#39;</span><span class="p">]</span>

        <span class="n">logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">pooled_hidden</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">!=</span> <span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">ModeKeys</span><span class="o">.</span><span class="n">PREDICT</span><span class="p">:</span>
            <span class="c1"># this is the same as the label_id returned by vector_fit_label_handling_fn</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_label_ids&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem_name</span><span class="p">)]</span>

            <span class="n">loss</span> <span class="o">=</span> <span class="n">empty_tensor_handling_loss</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">logits</span><span class="p">,</span> <span class="n">cosine_wrapper</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">nan_loss_handling</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_loss</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_metric</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">negative</span><span class="p">(</span>
                <span class="n">loss</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_cos_sim&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem_name</span><span class="p">),</span> <span class="n">aggregation</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">logits</span>

<span class="c1"># label handling fn</span>
<span class="k">def</span> <span class="nf">vector_fit_label_handling_fn</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">label_encoder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decoding_length</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># don&#39;t need to encoder labels, return array directly</span>
    <span class="c1"># return label_id and label mask</span>
    <span class="n">label_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">label_id</span><span class="p">,</span> <span class="kc">None</span>

<span class="c1"># make label encoder</span>
<span class="k">def</span> <span class="nf">vector_fit_get_or_make_label_encoder_fn</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">Params</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">label_list</span><span class="p">):</span>
    <span class="c1"># don&#39;t need to make label encoder here</span>
    <span class="c1"># set params num_classes for this problem</span>
    <span class="n">label_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">label_list</span><span class="p">)</span>
    <span class="n">params</span><span class="o">.</span><span class="n">num_classes</span><span class="p">[</span><span class="n">problem</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="n">params</span><span class="o">.</span><span class="n">register_problem_type</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s1">&#39;vectorfit&#39;</span><span class="p">,</span> <span class="n">top_layer</span><span class="o">=</span><span class="n">VectorFit</span><span class="p">,</span> <span class="n">label_handling_fn</span><span class="o">=</span><span class="n">vector_fit_label_handling_fn</span><span class="p">,</span> <span class="n">get_or_make_label_encoder_fn</span><span class="o">=</span><span class="n">vector_fit_get_or_make_label_encoder_fn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Utils">Utils<a class="anchor-link" href="#Utils"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseParams.from_json" class="doc_header"><code>BaseParams.from_json</code><a href="https://github.com/JayYip/m3tl/tree/master/m3tl/base_params.py#L213" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseParams.from_json</code>(<strong><code>json_path</code></strong>:<code>str</code>=<em><code>None</code></em>)</p>
</blockquote>
<p>Load json file as params.</p>
<p>json_path could not be None if the problem is not assigned to params</p>
<p>Args:
    json_path (str, optional): Path to json file. Defaults to None.</p>
<p>Raises:
    AttributeError</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseParams.to_json" class="doc_header"><code>BaseParams.to_json</code><a href="https://github.com/JayYip/m3tl/tree/master/m3tl/base_params.py#L199" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseParams.to_json</code>()</p>
</blockquote>
<p>Save the params as json files. Please note that processing_fn is not saved.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseParams.parse_problem_string" class="doc_header"><code>BaseParams.parse_problem_string</code><a href="https://github.com/JayYip/m3tl/tree/master/m3tl/base_params.py#L248" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseParams.parse_problem_string</code>(<strong><code>flag_string</code></strong>:<code>str</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Parse problem string</p>
<p>Arguments: flag_string {str} -- problem string</p>
<p>Returns: list -- problem list</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;chained with |: &#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">parse_problem_string</span><span class="p">(</span><span class="s1">&#39;toy_seq_tag|toy_cls&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;chained with &amp;: &#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">parse_problem_string</span><span class="p">(</span><span class="s1">&#39;toy_seq_tag&amp;toy_cls&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>chained with |:  ([&#39;toy_cls&#39;, &#39;toy_seq_tag&#39;], [[&#39;toy_seq_tag&#39;], [&#39;toy_cls&#39;]])
chained with &amp;:  ([&#39;toy_cls&#39;, &#39;toy_seq_tag&#39;], [[&#39;toy_seq_tag&#39;, &#39;toy_cls&#39;]])
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseParams.get_problem_type" class="doc_header"><code>BaseParams.get_problem_type</code><a href="https://github.com/JayYip/m3tl/tree/master/m3tl/base_params.py#L438" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseParams.get_problem_type</code>(<strong><code>problem</code></strong>:<code>str</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">params</span><span class="o">.</span><span class="n">get_problem_type</span><span class="p">(</span><span class="s1">&#39;toy_seq_tag&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;seq_tag&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseParams.update_train_steps" class="doc_header"><code>BaseParams.update_train_steps</code><a href="https://github.com/JayYip/m3tl/tree/master/m3tl/base_params.py#L441" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseParams.update_train_steps</code>(<strong><code>train_steps_per_epoch</code></strong>:<code>int</code>, <strong><code>epoch</code></strong>:<code>int</code>=<em><code>None</code></em>, <strong><code>warmup_ratio</code></strong>=<em><code>0.1</code></em>)</p>
</blockquote>
<p>If the batch_size is dynamic, we have to loop through the tf.data.Dataset
to get the accurate number of training steps. In this case, we need a function to
update the train_steps which will be used to calculate learning rate schedule.</p>
<p>WARNING: updating should be called before the model is compiled!</p>
<p>Args:
    train_steps (int): new number of train_steps</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If the batch_size is dynamic, we have to loop through the tf.data.Dataset
to get the accurate number of training steps. In this case, we need a function to
update the train_steps which will be used to calculate learning rate schedule.</p>
<p>WARNING: updating should be called before the model is compiled!</p>
<p>Args:</p>
<ul>
<li>train_steps (int): new number of train_steps</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">params</span><span class="o">.</span><span class="n">update_train_steps</span><span class="p">(</span><span class="n">train_steps_per_epoch</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">train_steps</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_warmup_steps</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1500 150
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseParams.assign_data_sampling_strategy" class="doc_header"><code>BaseParams.assign_data_sampling_strategy</code><a href="https://github.com/JayYip/m3tl/tree/master/m3tl/base_params.py#L675" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseParams.assign_data_sampling_strategy</code>(<strong><code>sampling_strategy_name</code></strong>=<em><code>'data_balanced'</code></em>, <strong><code>sampling_strategy_fn</code></strong>:<code>Callable</code>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Set data sampling strategy for multi-task learning.</p>
<p>'data_balanced' and 'problem_balanced' is implemented by default.
data_balanced: sampling weight equals to number of rows of that problem chunk.
problem_balanced: sampling weight equals to 1 for every problem chunk.</p>
<p>Args:</p>
<ul>
<li>sampling_strategy (str, optional): sampling strategy. Defaults to 'data_balanced'.</li>
<li>sampling_strategy_fn (Callable, optional): function to create weight dict. Defaults to None.</li>
</ul>
<p>Raises:</p>
<ul>
<li>NotImplementedError: sampling_strategy_fn is not implemented yet</li>
<li>ValueError: invalid sampling_strategy provided</li>
</ul>
<p>Returns:</p>
<ul>
<li>Dict[str, float]: sampling weight for each problem_chunk</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">params</span><span class="o">.</span><span class="n">assign_data_sampling_strategy</span><span class="p">(</span><span class="n">sampling_strategy_name</span><span class="o">=</span><span class="s1">&#39;problem_balanced&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

